<!-- Traction-Receipt.html (FULL DROP-IN REPLACEMENT) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Proof-of-Thought — Traction</title>
  <style>
    :root{
      --bg:#0b0d12; --panel:#111522; --panel2:#0f1320; --ink:#e9edf7; --muted:#a6b0c5;
      --line:#24304a; --good:#52f2a8; --warn:#ffd36a; --bad:#ff6b6b; --accent:#6aa6ff;
      --shadow: 0 14px 50px rgba(0,0,0,.45);
      --r:16px;
      font-synthesis-weight:none;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 50% -10%, rgba(106,166,255,.18), transparent 55%),
        radial-gradient(900px 500px at 10% 20%, rgba(82,242,168,.10), transparent 60%),
        var(--bg);
      color:var(--ink);
      font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:28px 18px 60px}

    /* top */
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:14px; margin-bottom:18px}
    .brand{display:flex; align-items:center; gap:10px}
    .mark{
      width:34px; height:34px; border-radius:12px;
      background:linear-gradient(135deg, rgba(106,166,255,.9), rgba(82,242,168,.75));
      box-shadow: 0 10px 30px rgba(106,166,255,.12);
    }
    .brand h1{font-size:14px; margin:0; letter-spacing:.2px; font-weight:650}
    .brand small{display:block; margin-top:2px; color:var(--muted); font-weight:500}

    .pillrow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .pill{
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06);
      padding:8px 10px; border-radius:999px; color:var(--muted);
      display:flex; gap:8px; align-items:center
    }
    .dot{width:8px; height:8px; border-radius:999px; background:var(--good)}
    .dot.warn{background:var(--warn)}

    /* cards */
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }
    .card .pad{padding:16px}

    .kicker{color:var(--muted); font-weight:650; letter-spacing:.5px; text-transform:uppercase; font-size:11px}
    .title{margin:6px 0 8px; font-size:18px; font-weight:750; letter-spacing:.2px}
    .sub{margin:0; color:var(--muted)}
    .sub.micro{font-size:12px; opacity:.9}

    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .chip{
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
      padding:8px 10px; border-radius:12px; color:var(--muted)
    }
    .chip b{color:var(--ink); font-weight:650}

    .ctaRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .btn{
      border-radius:14px; padding:10px 12px; font-weight:650;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05); color:var(--ink);
      cursor:pointer
    }
    .btn.primary{
      background:linear-gradient(135deg, rgba(106,166,255,.9), rgba(106,166,255,.55));
      border-color: rgba(106,166,255,.7)
    }
    .btn.ghost{background:transparent}
    .btn:active{transform: translateY(1px)}

    /* metrics */
    .metrics{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:14px;
    }
    @media (max-width: 820px){ .metrics{grid-template-columns:1fr} }

    .mBox{
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      padding:12px;
    }
    .mLbl{color:var(--muted); font-weight:650; font-size:11px; letter-spacing:.4px; text-transform:uppercase}
    .mVal{margin-top:6px; font-size:20px; font-weight:850}
    .mVal small{font-weight:750; color:var(--muted); font-size:12px}
    .bar{height:10px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; margin-top:10px}
    .bar > i{display:block; height:100%; width:50%; background:linear-gradient(90deg, rgba(82,242,168,.95), rgba(106,166,255,.85))}
    .hint{color:var(--muted); font-size:12px; margin-top:10px}

    /* layout */
    .hero{display:grid; grid-template-columns: 1.25fr .75fr; gap:14px; margin: 16px 0 18px}
    @media (max-width: 900px){.hero{grid-template-columns:1fr}}

    .fullRow{margin-top:14px}

    .grid{display:grid; grid-template-columns: 1fr .52fr; gap:14px; margin-top:14px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}

    /* ruler */
    .rulerWrap{margin-top:6px}
    .rulerTop{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}

    .rulerLine{
    margin-top:12px;
    position:relative;
    height:120px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.08);
    background:rgba(0,0,0,.18);
    padding:12px 12px 14px;
    overflow:hidden;          /* allow horizontal scroll + zoomed canvas */
    overscroll-behavior: contain;
    scrollbar-width: thin;  /* Firefox: subtle */            /* IMPORTANT: now we pan inside */
    cursor: grab;                 /* drag-to-pan affordance */
    user-select:none;             /* nicer dragging */
    touch-action: none;           /* prevents browser gestures interfering */
    }
    .rulerLine:active{ cursor: grabbing; }
    .rulerLine::before{ display:none !important; }

    /* create an inner “track” that becomes wider when zoomed */
    .rulerTrack{
    position:absolute;
    left:28px;           /* visual gutter */
    top:0;
    bottom:0;
    width:calc(100% - 28px);
    }
    /* */

    /* major ticks (lane stacked) */
    .tick{
      position:absolute;
      transform:translateX(-50%);
      text-align:center;
      width:150px;
      pointer-events:none;
      top: calc(10px + (var(--lane, 0) * 36px));
    }
    .tick .stem{
      width:2px; height:16px;
      background:rgba(255,255,255,.30);
      margin:0 auto;
      border-radius:2px;
    }
    .tick .dot{
      width:7px; height:7px;
      border-radius:999px;
      margin:5px auto 0;
      background:var(--accent);
      box-shadow:0 0 0 3px rgba(106,166,255,.10);
    }
    .tick.ack .dot{ background: var(--good); box-shadow:0 0 0 3px rgba(82,242,168,.10); }
    .tick.val .dot{ background: var(--warn); box-shadow:0 0 0 3px rgba(255,211,106,.10); }

    .tick .type{
      font-size:11px;
      font-weight:800;
      color:rgba(233,237,247,.92);
      margin-top:6px;
      white-space:nowrap;
    }
    .tick .lab{
      margin-top:3px;
      font-size:11px;
      color:var(--muted);
      white-space:nowrap;
    }

    /* minor month ticks */
    .minorTick{
      position:absolute;
      transform:translateX(-50%);
      width:18px;
      text-align:center;
      pointer-events:none;
      top:34px;
    }
    .minorTick .mStem{
      width:1px;
      height:10px;
      background:rgba(255,255,255,.18);
      margin:0 auto;
      border-radius:1px;
    }
    .minorTick .mLab{
      margin-top:8px;
      font-size:10px;
      color:rgba(255,255,255,.20);
      white-space:nowrap;
    }
    .minorTick.q .mLab{ color:rgba(255,255,255,.32); }

    /* table */
    .table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:14px}
    .table th, .table td{padding:12px 12px; border-bottom:1px solid rgba(255,255,255,.07); vertical-align:top}
    .table th{
      color:var(--muted); font-weight:700; text-transform:uppercase;
      font-size:11px; letter-spacing:.4px; background: rgba(0,0,0,.18)
    }
    .table tr:hover td{background: rgba(255,255,255,.03)}

    .person{display:flex; align-items:flex-start; gap:10px}
    .avatar{
      width:34px; height:34px; border-radius:12px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
      display:grid; place-items:center; font-weight:800; color:rgba(255,255,255,.75)
    }
    .pname{font-weight:750; margin:0}
    .pmeta{color:var(--muted); margin-top:2px; font-size:12px}

    .tagRow{display:flex; gap:8px; flex-wrap:wrap}
    .tag{
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
      border-radius:999px; padding:6px 8px; color:var(--muted);
      font-weight:650; font-size:12px
    }
    .tag.good{border-color: rgba(82,242,168,.35); color: rgba(82,242,168,.95)}
    .tag.warn{border-color: rgba(255,211,106,.35); color: rgba(255,211,106,.95)}

    /* sidebar */
    .side .item{
      padding:12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18)
    }
    .side .item + .item{margin-top:10px}
    .side h3{margin:0 0 6px; font-size:13px; font-weight:800}
    .side p{margin:0; color:var(--muted)}
    .side code{
      display:block; margin-top:8px; padding:10px; border-radius:12px;
      background:rgba(0,0,0,.28); border:1px solid rgba(255,255,255,.08);
      color:#cfe0ff; overflow:auto
    }

    /* modal */
    .modal{position:fixed; inset:0; background: rgba(0,0,0,.62); display:none; align-items:center; justify-content:center; padding:18px}
    .modal.open{display:flex}
    .modal .box{
      max-width:720px; width:100%;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(17,21,34,.98), rgba(12,15,25,.98));
      box-shadow: var(--shadow)
    }
    .modal .hd{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      padding:16px 16px 10px; border-bottom:1px solid rgba(255,255,255,.08)
    }
    .modal .hd h2{margin:0; font-size:15px; font-weight:850}
    .x{
      background:transparent; border:1px solid rgba(255,255,255,.14);
      color:var(--ink); border-radius:12px; padding:8px 10px; cursor:pointer
    }
    .modal .bd{padding:14px 16px 16px}
    .kv{
      display:grid; grid-template-columns: 170px 1fr; gap:10px;
      padding:10px 0; border-bottom:1px solid rgba(255,255,255,.06)
    }
    .kv:last-child{border-bottom:0}
    .kv .k{
      color:var(--muted); font-weight:700; text-transform:uppercase;
      font-size:11px; letter-spacing:.4px
    }
    .kv .v{font-weight:650}

    .foot{margin-top:16px; color:var(--muted); font-size:12px}
    .foot.micro{font-size:11px; opacity:.85}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <h1>Proof-of-Thought <span style="opacity:.75">/ Traction</span></h1>
          <small>What the creator sees after recipients respond (acknowledgement + valuation).</small>
        </div>
      </div>
      <div class="pillrow">
        <div class="pill"><span class="dot"></span> Record is sealed</div>
        <div class="pill"><span class="dot warn"></span> Ledger anchor pending</div>
      </div>
    </div>

    <div class="hero">
      <!-- MAIN -->
      <div class="card">
        <div class="pad">
          <div class="kicker">Genesis Record</div>
          <div class="title">R-0000…1 — “Proof-of-Thought: cryptographic custody chains for cognitive artifacts”</div>
          <p class="sub">This page aggregates third-party responses as <b>signals</b> attached to the sealed record (without exposing sealed bytes).</p>

          <div class="row">
            <div class="chip"><b>Sealed</b> Jan 13, 2026 • 13:08 PT</div>
            <div class="chip"><b>Hash</b> 9f2a…c81d</div>
            <div class="chip"><b>Disclosure</b> handle-only</div>
            <div class="chip"><b>Acks</b> 3</div>
            <div class="chip"><b>Valuations</b> 2</div>
          </div>

          <div class="ctaRow">
            <button class="btn primary" id="btnInvite">Request acknowledgement</button>
            <button class="btn" id="btnExport">Export proof bundle</button>
            <button class="btn ghost" id="btnShare">Copy verifier link</button>
          </div>

          <!-- Metrics -->
          <div class="metrics">
            <div class="mBox">
              <div class="mLbl">Signal Score</div>
              <div class="mVal" id="sigScore">62 <small>/ 100</small></div>
              <div class="bar" aria-hidden="true"><i id="sigBar" style="width:62%"></i></div>
              <div class="hint">Simple v1: count + credibility + valuations present.</div>
            </div>

            <div class="mBox">
              <div class="mLbl">Median valuation</div>
              <div class="mVal" id="medVal">$10k <small>($1k–$100k)</small></div>
              <div class="bar" aria-hidden="true"><i id="valBar" style="width:44%"></i></div>
              <div class="hint">Signal only. Not rights. Not ownership. Not an offer.</div>
            </div>

            <div class="mBox">
              <div class="mLbl">Credibility weight</div>
              <div class="mVal" id="credVal">A <small>(High)</small></div>
              <div class="bar" aria-hidden="true"><i id="credBar" style="width:78%"></i></div>
              <div class="hint">V1: A / B / C based on invitee verification + role tag.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SIDEBAR -->
      <div class="card side">
        <div class="pad">
          <div class="kicker">Quick context</div>

          <div class="item">
            <h3>What’s recorded</h3>
            <p>Append-only entries: timestamp, responder identity (or pseudonym), response type, and optional note.</p>
          </div>

          <div class="item">
            <h3>Response types</h3>
            <div class="tagRow" style="margin-top:8px">
              <span class="tag good">Acknowledgement</span>
              <span class="tag warn">Valuation</span>
              <span class="tag">Feedback (optional)</span>
            </div>
          </div>

          <div class="item">
            <h3>Public verifier (optional)</h3>
            <p>Share a short verifier handle that reveals only what you choose.</p>
            <code id="verifierLink">pot.io/v/R-0000…1?d=1&v=range</code>
          </div>

          <div class="item">
            <h3>Ledger anchoring</h3>
            <p>Not required.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- FULL-WIDTH TIMELINE -->
    <div class="fullRow">
      <div class="card">
        <div class="pad">
          <div class="rulerTop">
            <div class="kicker">Traction timeline</div>
            <div class="sub micro" style="margin:0">First tick = sealed. New ticks = ack/valuation events.</div>
          </div>

          <div class="rulerLine" id="ruler" aria-label="Timeline ruler">
            <div class="rulerCanvas" id="rulerCanvas"></div>
          </div>

          <div class="foot micro" style="margin-top:10px;">
            Horizon shows month marks; events stack automatically when close together.
          </div>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- Responses table -->
      <div class="card">
        <div class="pad">
          <div class="kicker">Responses</div>
          <div class="title" style="font-size:15px">Acknowledgements and valuations attached to this record</div>
          <p class="sub">Click a row to view details. (Mock data.)</p>

          <div style="overflow:auto; border-radius:14px; border:1px solid rgba(255,255,255,.08); background: rgba(0,0,0,.14);">
            <table class="table" role="table" aria-label="Responses">
              <thead>
                <tr>
                  <th style="width:38%">Responder</th>
                  <th style="width:22%">Signal</th>
                  <th style="width:18%">When</th>
                  <th style="width:22%">Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr class="rowClick" data-name="A. Domain Expert" data-role="Materials Science"
                    data-type="Acknowledgement" data-val="—"
                    data-why="Confirmed receipt and existence; no valuation."
                    data-proof="Signed response receipt #ACK-91f2">
                  <td>
                    <div class="person">
                      <div class="avatar">A</div>
                      <div>
                        <p class="pname">A. Domain Expert</p>
                        <div class="pmeta">Materials Science • Verified</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="tagRow">
                      <span class="tag good">Acknowledged</span>
                      <span class="tag">Existence</span>
                    </div>
                  </td>
                  <td class="pmeta">Jan 13, 2026 • 14:10</td>
                  <td class="pmeta">“Clear category. Worth exploring.”</td>
                </tr>

                <tr class="rowClick" data-name="B. Angel Investor" data-role="Seed / Pre-seed"
                    data-type="Valuation (range)" data-val="$10k–$100k"
                    data-why="Selected a valuation range; added a short note."
                    data-proof="Signed response receipt #VAL-1c0b">
                  <td>
                    <div class="person">
                      <div class="avatar">B</div>
                      <div>
                        <p class="pname">B. Angel Investor</p>
                        <div class="pmeta">Seed / Pre-seed • Verified</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="tagRow">
                      <span class="tag warn">Valuation</span>
                      <span class="tag">Range</span>
                    </div>
                  </td>
                  <td class="pmeta">Jan 13, 2026 • 15:02</td>
                  <td class="pmeta">“If privacy holds, this is interesting.”</td>
                </tr>

                <tr class="rowClick" data-name="C. Product Leader" data-role="Platform / Security"
                    data-type="Acknowledgement" data-val="—"
                    data-why="Acknowledged existence; requested more disclosure."
                    data-proof="Signed response receipt #ACK-04d9">
                  <td>
                    <div class="person">
                      <div class="avatar">C</div>
                      <div>
                        <p class="pname">C. Product Leader</p>
                        <div class="pmeta">Platform / Security • Unverified</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="tagRow">
                      <span class="tag good">Acknowledged</span>
                      <span class="tag">Receipt</span>
                    </div>
                  </td>
                  <td class="pmeta">Jan 13, 2026 • 16:41</td>
                  <td class="pmeta">“Send one more sentence?”</td>
                </tr>

                <tr class="rowClick" data-name="D. Founder Friend" data-role="Operator"
                    data-type="Valuation (range)" data-val="$1k–$10k"
                    data-why="Chose a conservative range; offered to intro someone."
                    data-proof="Signed response receipt #VAL-7a2e">
                  <td>
                    <div class="person">
                      <div class="avatar">D</div>
                      <div>
                        <p class="pname">D. Founder Friend</p>
                        <div class="pmeta">Operator • Verified</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="tagRow">
                      <span class="tag warn">Valuation</span>
                      <span class="tag">Range</span>
                    </div>
                  </td>
                  <td class="pmeta">Jan 13, 2026 • 17:20</td>
                  <td class="pmeta">“Happy to intro a partner.”</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="foot">Implementation hint: store responses as an append-only log tied to the record ID; allow selective disclosure for handle vs sealed bytes.</div>
        </div>
      </div>

      <!-- Activity log -->
      <div class="card">
        <div class="pad">
          <div class="kicker">Activity log</div>
          <div class="title" style="font-size:15px">Record activity</div>
          <div style="height:10px"></div>

          <div class="side">
            <div class="item">
              <h3>Sealed</h3>
              <p>Canonical bytes generated + trusted timestamp bound.</p>
              <p class="pmeta">13:08</p>
            </div>
            <div class="item">
              <h3>Invites sent</h3>
              <p>3 recipients invited (manual send).</p>
              <p class="pmeta">13:22</p>
            </div>
            <div class="item">
              <h3>First acknowledgement received</h3>
              <p>Stored as append-only response entry.</p>
              <p class="pmeta">14:10</p>
            </div>
            <div class="item">
              <h3>First valuation received</h3>
              <p>Recorded as optional signal (no rights).</p>
              <p class="pmeta">15:02</p>
            </div>
            <div class="item">
              <h3>Anchor pending</h3>
              <p>Optional — can be executed later.</p>
              <p class="pmeta">—</p>
            </div>
          </div>

          <div class="foot">V1 keeps this simple; the ruler above is the “at-a-glance” version.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <div class="hd">
        <div>
          <h2 id="mTitle">Response details</h2>
          <div class="pmeta" id="mSub">—</div>
        </div>
        <button class="x" id="mClose">Close</button>
      </div>
      <div class="bd">
        <div class="kv"><div class="k">Responder</div><div class="v" id="mName">—</div></div>
        <div class="kv"><div class="k">Role</div><div class="v" id="mRole">—</div></div>
        <div class="kv"><div class="k">Signal</div><div class="v" id="mType">—</div></div>
        <div class="kv"><div class="k">Valuation</div><div class="v" id="mVal">—</div></div>
        <div class="kv"><div class="k">Note</div><div class="v" id="mWhy">—</div></div>
        <div class="kv"><div class="k">Receipt</div><div class="v" id="mProof">—</div></div>
        <div class="hint">Mock-only: production can include disclosure scope + verifier link + optional anchor proof if enabled.</div>
      </div>
    </div>
  </div>

  <script>
    // ----- Modal logic
    const modal = document.getElementById('modal');
    const mClose = document.getElementById('mClose');

    function openModal(row){
      document.getElementById('mName').textContent = row.dataset.name || '—';
      document.getElementById('mRole').textContent = row.dataset.role || '—';
      document.getElementById('mType').textContent = row.dataset.type || '—';
      document.getElementById('mVal').textContent = row.dataset.val || '—';
      document.getElementById('mWhy').textContent = row.dataset.why || '—';
      document.getElementById('mProof').textContent = row.dataset.proof || '—';
      document.getElementById('mSub').textContent = 'Attached to R-0000…1';
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    document.querySelectorAll('.rowClick').forEach(tr=>{
      tr.style.cursor='pointer';
      tr.addEventListener('click', ()=>openModal(tr));
    });
    mClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    // ----- Mock actions
    document.getElementById('btnInvite').addEventListener('click', ()=>alert('Mock: open Ack-Invite composer'));
    document.getElementById('btnExport').addEventListener('click', ()=>alert('Mock: export proof bundle'));
    document.getElementById('btnShare').addEventListener('click', ()=>{
      const link = document.getElementById('verifierLink').textContent.trim();
      navigator.clipboard?.writeText(link);
      alert('Mock: verifier link copied');
    });

    
    // ----- Traction timeline (ruler) — time-zoom + pan (no pixel-stretching)
    // Goal:
    //   - Default view shows ~1 week so mock events "spread out" (presentation-friendly)
    //   - Wheel zoom (Ctrl/⌘ + wheel), drag-to-pan
    //   - When zoomed in (week or less), events spread along X before stacking

    const horizonMonths = 12; // set to 24 for 2-year horizon
    const startISO = "2026-01-13T13:08:00-08:00"; // sealed time (mock)

    function addMonths(date, n){
      const d = new Date(date);
      const day = d.getDate(); // keep your existing rollover safety
      d.setMonth(d.getMonth() + n);
      if (d.getDate() < day) d.setDate(0);
      return d;
    }

    const baseStart = new Date(startISO);
    const baseEnd   = addMonths(baseStart, horizonMonths);
    const baseSpanMs = Math.max(1, baseEnd.getTime() - baseStart.getTime());

    // Mock events — spread across about a week
    function generateMockEventsWeekly(sealedAt){
      const t0 = sealedAt.getTime();
      const H = 60 * 60 * 1000;
      const D = 24 * H;
      return [
        { type:"sealed", label:"Sealed",    at: new Date(t0) },
        { type:"invite", label:"Invites",   at: new Date(t0 + 2.4 * H) },   // same day
        { type:"ack",    label:"Ack",       at: new Date(t0 + 1.9 * D) },   // day ~2
        { type:"val",    label:"Valuation", at: new Date(t0 + 3.2 * D) },   // day ~3
        { type:"ack",    label:"Ack",       at: new Date(t0 + 4.6 * D) },   // day ~5
        { type:"val",    label:"Valuation", at: new Date(t0 + 6.0 * D) },   // day ~7
      ];
    }

    const events = generateMockEventsWeekly(baseStart);

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
    function pctBetween(date, min, max){
      const t = date.getTime(), a = min.getTime(), b = max.getTime();
      const span = Math.max(1, b - a);
      return ((t - a) / span) * 100;
    }

    function fmtMonth(d){ return d.toLocaleString("en-US", { month:"short" }); }
    function fmtDateTime(d){
      const m = d.toLocaleString("en-US", { month:"short" });
      const day = d.getDate();
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      return `${m} ${day} • ${hh}:${mm}`;
    }

    // ---- Zoom + pan state (timeline only)
    let zoom = 1;        // higher = tighter time window
    let panPx = 0;       // 0..usable (maps across full horizon)
    const ZOOM_MIN = 1;
    const ZOOM_MAX = 80; // allow ~1-week default on a 12mo horizon
    const REQUIRE_MODIFIER_FOR_ZOOM = true;

    // For left-edge crop safety (moves ticks away from the rounded card edge)
    const SAFE_GUTTER_PX = 22;

    // Compute visible domain for current zoom/pan and container usable width
    function computeDomain(usable){
      const MIN_SPAN_MS = 6 * 60 * 60 * 1000;   // 6 hours (super-zoom)
      const MAX_SPAN_MS = baseSpanMs;

      const visibleSpanMs = clamp(baseSpanMs / zoom, MIN_SPAN_MS, MAX_SPAN_MS);

      // panPx => panFrac across the *full* horizon
      panPx = clamp(panPx, 0, usable);
      const panFrac = usable <= 1 ? 0 : (panPx / usable);

      const centerMs = baseStart.getTime() + panFrac * baseSpanMs;

      let domainStart = new Date(centerMs - visibleSpanMs / 2);
      let domainEnd   = new Date(centerMs + visibleSpanMs / 2);

      // Clamp to base horizon
      if (domainStart < baseStart){
        domainStart = new Date(baseStart);
        domainEnd   = new Date(baseStart.getTime() + visibleSpanMs);
      }
      if (domainEnd > baseEnd){
        domainEnd   = new Date(baseEnd);
        domainStart = new Date(baseEnd.getTime() - visibleSpanMs);
      }

      return { domainStart, domainEnd, visibleSpanMs };
    }

    function renderRuler(){
      const rulerEl = document.getElementById("ruler");
      if (!rulerEl) return;

      // Build inside a “track”
      rulerEl.innerHTML = "";
      const track = document.createElement("div");
      track.className = "rulerTrack";
      rulerEl.appendChild(track);

      const inset = 28; // keep the left edge comfortably inside the card
      const w = rulerEl.clientWidth;
      const usable = Math.max(1, w - inset * 2);

      // Domain for current view
      const { domainStart, domainEnd, visibleSpanMs } = computeDomain(usable);

      // helper: pct -> x with an extra gutter so text doesn't touch the edge
      const innerW = Math.max(1, usable - SAFE_GUTTER_PX * 2);
      const toX = (pct) => SAFE_GUTTER_PX + innerW * (pct / 100);

      // Main horizon line (single line — we also use the CSS :before line, so we disable it by not relying on it)
      const line = document.createElement("div");
      line.style.position = "absolute";
      line.style.left = "0px";
      line.style.right = "0px";
      line.style.top = "44px";
      line.style.height = "2px";
      line.style.background = "rgba(255,255,255,.16)"; // slightly stronger
      track.appendChild(line);

      // Minor ticks: months when zoomed out; days when zoomed in
      const spanDays = visibleSpanMs / (24*60*60*1000);
      const useDays = spanDays <= 60;

      if (!useDays){
        for (let i = 0; i <= horizonMonths; i++){
          const d = addMonths(baseStart, i);
          const pct = pctBetween(d, domainStart, domainEnd);
          if (pct < 0 || pct > 100) continue;

          const isQuarter = (i % 3 === 0);
          const showLabel = (i === 0) || (i === horizonMonths) || isQuarter;

          const t = document.createElement("div");
          t.className = "minorTick" + (isQuarter ? " q" : "");
          t.style.left = `${toX(pct)}px`;
          t.innerHTML = `
            <div class="mStem"></div>
            <div class="mLab">${showLabel ? fmtMonth(d) : ""}</div>
          `;
          track.appendChild(t);
        }
      } else {
        const dayMs = 24*60*60*1000;
        const first = new Date(domainStart); first.setHours(0,0,0,0);
        const last  = new Date(domainEnd);   last.setHours(0,0,0,0);

        let idx = 0;
        for (let tMs = first.getTime(); tMs <= last.getTime(); tMs += dayMs){
          const d = new Date(tMs);
          const pct = pctBetween(d, domainStart, domainEnd);
          if (pct < 0 || pct > 100) continue;

          const tick = document.createElement("div");
          tick.className = "minorTick";
          tick.style.left = `${toX(pct)}px`;

          const labelEvery = spanDays <= 14 ? 1 : 2;
          const showLabel = (idx % labelEvery === 0) || (tMs === first.getTime()) || (tMs === last.getTime());

          tick.innerHTML = `
            <div class="mStem"></div>
            <div class="mLab">${showLabel ? d.toLocaleString("en-US",{month:"short", day:"numeric"}) : ""}</div>
          `;
          track.appendChild(tick);
          idx++;
        }
      }

      // Major events with pixel-based lane stacking
      // NOTE: Larger minDx makes the “week or less” view spread horizontally before stacking.
      const minDx = spanDays <= 14 ? 90 : 60;
      const laneMax = 6;

      const placed = events
        .map(e => ({...e, pct: pctBetween(e.at, domainStart, domainEnd)}))
        .filter(e => e.pct >= 0 && e.pct <= 100)
        .map(e => ({...e, x: toX(e.pct)}))
        .sort((a,b)=>a.x-b.x);

      const laneLastX = [];
      let maxLaneUsed = 0;

      placed.forEach((e) => {
        let lane = 0;
        while (lane <= laneMax){
          const last = laneLastX[lane];
          if (last === undefined || Math.abs(e.x - last) >= minDx) break;
          lane++;
        }
        lane = Math.min(lane, laneMax);

        laneLastX[lane] = e.x;
        maxLaneUsed = Math.max(maxLaneUsed, lane);

        const tick = document.createElement("div");
        tick.className = "tick" + (e.type === "ack" ? " ack" : e.type === "val" ? " val" : "");
        tick.style.left = `${e.x}px`;
        tick.style.setProperty("--lane", String(lane));

        tick.innerHTML = `
          <div class="stem"></div>
          <div class="dot"></div>
          <div class="type">${e.label}</div>
          <div class="lab">${fmtDateTime(e.at)}</div>
        `;
        track.appendChild(tick);
      });

      // Fit height to lanes
      const baseH = 120;
      const extraPerLane = 36;
      rulerEl.style.height = `${baseH + (maxLaneUsed * extraPerLane)}px`;
    }

    function initTractionTimeline(){
      const rulerEl = document.getElementById("ruler");
      if (!rulerEl) return;

      // Default: ~1 week window, centered on the middle of the mock week
      const rect = rulerEl.getBoundingClientRect();
      const inset = 28;
      const usable = Math.max(1, rect.width - inset * 2);

      const WEEK_MS = 7 * 24 * 60 * 60 * 1000;
      zoom = clamp(baseSpanMs / WEEK_MS, ZOOM_MIN, ZOOM_MAX);

      const defaultCenter = baseStart.getTime() + (3.5 * 24 * 60 * 60 * 1000);
      const panFracDesired = clamp((defaultCenter - baseStart.getTime()) / baseSpanMs, 0, 1);
      panPx = panFracDesired * usable;

      renderRuler();

      // Wheel zoom (Ctrl/⌘ + wheel)
      rulerEl.addEventListener("wheel", (e) => {
        const wantsZoom = REQUIRE_MODIFIER_FOR_ZOOM ? (e.ctrlKey || e.metaKey) : true;
        if (!wantsZoom) return;

        e.preventDefault();

        const rect = rulerEl.getBoundingClientRect();
        const usable = Math.max(1, rect.width - inset * 2);

        // Mouse position inside timeline (0..usable)
        const mx = clamp((e.clientX - rect.left - inset), 0, usable);

        // Current domain and time under cursor
        const before = computeDomain(usable);
        const tUnderCursor = before.domainStart.getTime() + (mx / usable) * before.visibleSpanMs;

        // Zoom step
        const delta = -e.deltaY;
        const factor = delta > 0 ? 1.12 : (1 / 1.12);
        const nextZoom = clamp(zoom * factor, ZOOM_MIN, ZOOM_MAX);
        if (nextZoom === zoom) return;

        zoom = nextZoom;

        // New span
        const afterSpan = clamp(baseSpanMs / zoom, 6*60*60*1000, baseSpanMs);

        // New domainStart to keep tUnderCursor under the same mx
        let newDomainStartMs = tUnderCursor - (mx / usable) * afterSpan;
        // Clamp to horizon
        newDomainStartMs = clamp(newDomainStartMs, baseStart.getTime(), baseEnd.getTime() - afterSpan);

        const newCenterMs = newDomainStartMs + afterSpan / 2;
        const newPanFrac = clamp((newCenterMs - baseStart.getTime()) / baseSpanMs, 0, 1);
        panPx = newPanFrac * usable;

        renderRuler();
      }, { passive:false });

      // Drag to pan
      let dragging = false;
      let dragStartX = 0;
      let panStartPx = 0;

      rulerEl.addEventListener("mousedown", (e) => {
        dragging = true;
        dragStartX = e.clientX;
        panStartPx = panPx;
        rulerEl.style.cursor = "grabbing";
      });

      window.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        const rect = rulerEl.getBoundingClientRect();
        const usable = Math.max(1, rect.width - inset * 2);
        const dx = e.clientX - dragStartX;
        // drag right => earlier => panPx decreases
        panPx = clamp(panStartPx - dx, 0, usable);
        renderRuler();
      });

      window.addEventListener("mouseup", () => {
        dragging = false;
        rulerEl.style.cursor = "grab";
      });

      // Double-click reset
      rulerEl.addEventListener("dblclick", () => {
        const rect = rulerEl.getBoundingClientRect();
        const usable = Math.max(1, rect.width - inset * 2);
        zoom = 1;
        panPx = 0.0 * usable;
        renderRuler();
      });

      window.addEventListener("resize", renderRuler);
    }

    // Kick it off
    initTractionTimeline();

  </script>
</body>
</html>